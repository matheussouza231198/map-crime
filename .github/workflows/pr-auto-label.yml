name: PR Auto Label

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  auto-label:
    runs-on: ubuntu-latest
    steps:
      - name: Add labels based on PR content
        uses: actions/github-script@v7
        with:
          script: |
            const prBody = context.payload.pull_request.body || '';
            const prTitle = context.payload.pull_request.title || '';
            const labels = [];
            
            // Labels baseadas no tipo de mudanÃ§a
            if (/- \[x\].*ðŸ› Bug fix/i.test(prBody)) {
              labels.push('bug');
            }
            if (/- \[x\].*âœ¨ Feature/i.test(prBody)) {
              labels.push('enhancement');
            }
            if (/- \[x\].*ðŸ’¥ Breaking change/i.test(prBody)) {
              labels.push('breaking-change');
            }
            if (/- \[x\].*ðŸ“ DocumentaÃ§Ã£o/i.test(prBody)) {
              labels.push('documentation');
            }
            if (/- \[x\].*ðŸŽ¨ Estilo/i.test(prBody)) {
              labels.push('style');
            }
            if (/- \[x\].*â™»ï¸ RefatoraÃ§Ã£o/i.test(prBody)) {
              labels.push('refactor');
            }
            if (/- \[x\].*âš¡ Performance/i.test(prBody)) {
              labels.push('performance');
            }
            if (/- \[x\].*âœ… Testes/i.test(prBody)) {
              labels.push('tests');
            }
            if (/- \[x\].*ðŸ”§ ConfiguraÃ§Ã£o/i.test(prBody)) {
              labels.push('config');
            }
            
            // Labels baseadas no tÃ­tulo
            if (/\[WIP\]|\[DRAFT\]/i.test(prTitle)) {
              labels.push('work-in-progress');
            }
            if (/\[HOTFIX\]/i.test(prTitle)) {
              labels.push('hotfix');
            }
            
            // Adiciona as labels
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                labels: labels
              });
            }
